{
  "permissions": {
    "allow": [
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && pip install \"openpyxl>=3.1.0\" --quiet 2>&1)",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"import openpyxl; print\\('openpyxl', openpyxl.__version__\\)\")",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"\nfrom utils.text_extractor import extract_text\nimport tempfile, os, csv\n\n# CSV 추출 테스트\nwith tempfile.NamedTemporaryFile\\(mode='w', suffix='.csv', delete=False, encoding='utf-8'\\) as f:\n    w = csv.writer\\(f\\)\n    w.writerow\\(['이름', '과목', '학점', '제출일']\\)\n    w.writerow\\(['홍길동', '운영체제', 'A+', '2024-06-01']\\)\n    w.writerow\\(['이순신', '데이터베이스', 'B+', '2024-06-02']\\)\n    tmp = f.name\n\nresult = extract_text\\(tmp\\)\nos.unlink\\(tmp\\)\nprint\\('CSV 추출 결과:'\\)\nprint\\(repr\\(result\\)\\)\n\")",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"\nfrom utils.text_extractor import extract_text\nimport tempfile, os\nfrom openpyxl import Workbook\n\n# XLSX 추출 테스트\nwb = Workbook\\(\\)\nws = wb.active\nws.append\\(['프로젝트명', '담당자', '예산', '마감일']\\)\nws.append\\(['운영체제 과제1', '홍길동', '0', '2024-04-15']\\)\nws.append\\(['데이터베이스 설계', '이순신', '0', '2024-05-20']\\)\nws.append\\(['보안 취약점 분석', '강감찬', '0', '2024-06-01']\\)\n\ntmp = tempfile.mktemp\\(suffix='.xlsx'\\)\nwb.save\\(tmp\\)\n\nresult = extract_text\\(tmp\\)\nos.unlink\\(tmp\\)\nprint\\('XLSX 추출 결과:'\\)\nprint\\(repr\\(result\\)\\)\n\")",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"\nimport json, time\nimport numpy as np\nfrom sklearn.metrics.pairwise import cosine_similarity as sklearn_cs\n\n# 테스트용 임베딩 생성 \\(n=200, 384차원\\)\nnp.random.seed\\(42\\)\nn = 200\nembeddings = np.random.randn\\(n, 384\\).astype\\(np.float32\\)\n# L2 정규화\nnorms = np.linalg.norm\\(embeddings, axis=1, keepdims=True\\)\nembeddings = embeddings / norms\n\nembedding_jsons = [json.dumps\\(e.tolist\\(\\)\\) for e in embeddings]\n\n# --- 기존 방식: 쌍별 계산 ---\nfrom engines.tier2_embedding import compute_similarity\n\nt0 = time.perf_counter\\(\\)\npair_count = 0\nfor i in range\\(n\\):\n    for j in range\\(i + 1, n\\):\n        compute_similarity\\(embedding_jsons[i], embedding_jsons[j]\\)\n        pair_count += 1\nold_time = time.perf_counter\\(\\) - t0\n\n# --- 신규 방식: 행렬 일괄 계산 ---\nt0 = time.perf_counter\\(\\)\nmatrix = np.stack\\([np.array\\(json.loads\\(ej\\), dtype=np.float32\\) for ej in embedding_jsons]\\)\nsim_matrix = sklearn_cs\\(matrix, matrix\\)\nnew_time = time.perf_counter\\(\\) - t0\n\nprint\\(f'n={n}, 쌍 수={pair_count:,}'\\)\nprint\\(f'기존 방식:  {old_time:.3f}s'\\)\nprint\\(f'신규 방식:  {new_time:.3f}s'\\)\nprint\\(f'속도 향상:  {old_time / new_time:.1f}x'\\)\n# 결과 동일성 검증 \\(임의 쌍 10개 비교\\)\nimport random\nrandom.seed\\(1\\)\nfor _ in range\\(10\\):\n    i, j = random.sample\\(range\\(n\\), 2\\)\n    old_score = compute_similarity\\(embedding_jsons[i], embedding_jsons[j]\\)\n    new_score = float\\(sim_matrix[i, j]\\)\n    assert abs\\(old_score - new_score\\) < 1e-5, f'불일치: {old_score} vs {new_score}'\nprint\\('결과 동일성 검증: OK'\\)\n\")",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"\nimport json, time\nimport numpy as np\nfrom sklearn.metrics.pairwise import cosine_similarity as sklearn_cs\n\nnp.random.seed\\(42\\)\nn = 500\nembeddings = np.random.randn\\(n, 384\\).astype\\(np.float32\\)\nnorms = np.linalg.norm\\(embeddings, axis=1, keepdims=True\\)\nembeddings = embeddings / norms\nembedding_jsons = [json.dumps\\(e.tolist\\(\\)\\) for e in embeddings]\n\nt0 = time.perf_counter\\(\\)\nmatrix = np.stack\\([np.array\\(json.loads\\(ej\\), dtype=np.float32\\) for ej in embedding_jsons]\\)\nsim_matrix = sklearn_cs\\(matrix, matrix\\)\nnew_time = time.perf_counter\\(\\) - t0\n\npair_count = n * \\(n - 1\\) // 2\n# 기존 방식은 너무 오래 걸려서 n=200 결과로 외삽\nest_old = 6.024 * \\(pair_count / 19900\\)\nprint\\(f'n={n}, 쌍 수={pair_count:,}'\\)\nprint\\(f'기존 방식 추정: ~{est_old:.1f}s'\\)\nprint\\(f'신규 방식:       {new_time:.3f}s'\\)\nprint\\(f'추정 속도 향상:  ~{est_old / new_time:.0f}x'\\)\n\")",
      "Bash(cd \"/Users/kimjonggun/Library/Mobile Documents/com~apple~CloudDocs/01_Personal/07_Project/Clasp/backend\" && source venv/bin/activate && python -c \"\nfrom utils.cover_detector import is_cover_page\n\ncases = [\n    # \\(설명, 텍스트, 기대결과\\)\n\n    # ── 기존 패턴 유지 ──\n    \\('날짜 패턴 \\(2024년 1월\\)',     '컴퓨터공학과\\\\n2024년 1월 제출',                        True\\),\n    \\('날짜 패턴 \\(2024-06-01\\)',     '운영체제 과제\\\\n제출일: 2024-06-01',                   True\\),\n    \\('기존 학번 \\(20240001234\\)',    '학번: 20240001234\\\\n홍길동',                           True\\),\n\n    # ── 신규: 광의 식별번호 ──\n    \\('6자리 사번',                 '사원번호: 123456\\\\n홍길동 책임연구원',                    True\\),\n    \\('7자리 학번',                 '학번: 2023001\\\\n소속: 컴퓨터공학과',                    True\\),\n    \\('하이픈 없는 날짜형 번호',    '20240615\\\\n운영체제 기말과제',                           True\\),\n\n    # ── 신규: 키워드 패턴 ──\n    \\('담당교수 키워드',            '담당교수: 김철수\\\\n과목명: 운영체제',                    True\\),\n    \\('작성자 키워드',              '작성자: 이순신\\\\n부서: 개발팀',                         True\\),\n    \\('소속 키워드',                '소속: 컴퓨터공학부\\\\n성명: 강감찬',                     True\\),\n    \\('학과+제출일 키워드',         '학과: 전자공학과\\\\n제출일: 2024년 6월',                  True\\),\n    \\('지도교수 키워드',            '지도교수: 박교수\\\\n논문 제목: 딥러닝 기반 분류',          True\\),\n\n    # ── False negative — 긴 본문은 표지 아님 ──\n    \\('긴 본문 텍스트 \\(표지 아님\\)', '본 연구에서는 딥러닝 기반의 파일 분류 시스템을 제안한다. ' * 5, False\\),\n\n    # ── False positive 방지 확인 ──\n    \\('12자리 긴 숫자 \\(오매칭 방지\\)', '주문번호: 123456789012\\\\n배송 완료', False\\),  # 12자리 → 불일치\n]\n\nok = True\nfor desc, text, expected in cases:\n    result = is_cover_page\\(text\\)\n    status = '✅' if result == expected else '❌'\n    if result != expected:\n        ok = False\n    print\\(f'{status} {desc}: {result}'\\)\n\nprint\\(\\)\nprint\\('전체 결과:', '모두 통과' if ok else '일부 실패'\\)\n\")"
    ]
  }
}
