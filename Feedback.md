# 분류 정확도 향상 피드백

> 작성일: 2026-02-26  
> 분석 대상: `backend/engines/` 및 `backend/utils/text_extractor.py`

---

## 발견된 문제점

### 1. Tier 1 / Tier 2 카테고리 불일치 (가장 심각)

**파일:** `backend/engines/tier1_rule.py`, `backend/engines/tier2_embedding.py`

Tier 1의 `_EXT_CATEGORY_MAP`과 Tier 2의 `CATEGORY_KEYWORDS`가 **완전히 다른 카테고리 체계**를 사용한다.

| Tier 1 카테고리 | Tier 2 카테고리 |
|---|---|
| 문서, 프레젠테이션, 스프레드시트 | 문서, 프레젠테이션, 데이터 |
| 코드, 데이터, 이미지 | 프로그래밍, 보안, 머신러닝 |
| 영상, 오디오, 압축 | 네트워크, 알고리즘, 운영체제 |

**결과:** Tier 1이 신뢰도 0.70으로 `"코드"` 반환 → Tier 2 호출 → Tier 2는 `"프로그래밍"` 반환 → 같은 파일이 스캔할 때마다 다른 카테고리로 분류될 수 있음.

**해결 방향:** 두 Tier의 카테고리를 통일하거나, Tier 2의 `CATEGORY_KEYWORDS`에 Tier 1 카테고리를 포함시킨다.

---

### 2. Tier 1 임계값과 확장자 매핑 신뢰도 불일치

**파일:** `backend/engines/pipeline.py`, `backend/engines/tier1_rule.py`

- 확장자 매핑 결과는 항상 `confidence_score = 0.70` 반환
- `TIER1_CONFIDENCE_THRESHOLD = 0.80`

**결과:** 확장자로 명확히 분류 가능한 이미지(`.jpg`), 영상(`.mp4`), 오디오(`.mp3`), 압축(`.zip`) 파일도 **모두 Tier 2로 넘어간다.** 이 파일들은 텍스트 추출이 불가능하므로 Tier 2 호출 자체가 낭비이며, 결국 Tier 1 결과로 돌아온다.

**해결 방향 (택 1):**
- `TIER1_CONFIDENCE_THRESHOLD`를 `0.65`로 낮춘다.
- 또는 텍스트 추출 불가 확장자(이미지, 영상, 오디오, 압축)는 Tier 2를 건너뛰는 로직을 `pipeline.py`에 추가한다.

---

### 3. Tier 2 텍스트 입력 길이 제한

**파일:** `backend/engines/tier2_embedding.py` (59번째 줄)

```python
text_embedding = model.encode(text.strip()[:1000])
```

PDF 텍스트 추출 전략은 4구간 샘플링으로 최대 1200자를 추출하는데, Tier 2에서 1000자로 잘라버려 마지막 구간(85% 지점) 샘플이 무시된다.

**해결 방향:** 입력 길이를 `2000`자로 늘린다.

---

### 4. Tier 2 카테고리 키워드 빈약

**파일:** `backend/engines/tier2_embedding.py`

각 카테고리당 키워드가 7개 이하로, 한국어 실사용 문서 유형을 커버하기에 부족하다. 특히 대학생/직장인 타겟 사용자의 주요 파일 유형(과제, 레포트, 기획서, 계약서, 회의록 등)에 대한 키워드가 없다.

**해결 방향:** 카테고리별 키워드를 15개 이상으로 확장하고, 한국어 실사용 표현을 추가한다.

```python
# 확장 예시
"문서": [
    "보고서", "report", "논문", "paper", "제안서", "명세서",
    "과제", "레포트", "계획서", "기획서", "회의록", "계약서",
    "지침서", "매뉴얼", "안내문", "공문", "설명서"
],
```

---

### 5. PDF 텍스트 추출 전략의 맹점

**파일:** `backend/utils/text_extractor.py` (43번째 줄)

```python
start_page = 2 if total_pages >= 3 else 0
```

3페이지 이상이면 무조건 1~2페이지를 스킵한다. 단순한 2페이지 문서(표지 + 본문)의 경우 본문을 통째로 건너뛰는 문제는 없지만, 정확히 3페이지인 문서(표지 + 목차 + 본문 1페이지)는 본문이 1페이지뿐인데 그 1페이지만 샘플링 대상이 된다.

또한 4구간 샘플링 시 페이지 수가 적으면 같은 페이지가 중복 선택될 수 있다.

**해결 방향:** 유효 페이지 수가 4 미만일 경우 샘플링 없이 전체 텍스트를 사용한다.

---

### 6. 파일명 기반 분류 활용 부족

**파일:** `backend/engines/tier1_rule.py`

현재 파일명에서 연도 패턴만 추출한다. 한국어 파일명에는 분류에 유용한 패턴이 많다.

**해결 방향:** 파일명 키워드 패턴 매칭을 추가한다.

```python
_FILENAME_PATTERNS = [
    (re.compile(r"(과제|레포트|report|assignment)", re.I), "문서"),
    (re.compile(r"(발표|presentation|슬라이드)", re.I), "프레젠테이션"),
    (re.compile(r"(회의록|minutes|meeting)", re.I), "문서"),
    (re.compile(r"(기획서|proposal|계획서|plan)", re.I), "문서"),
    (re.compile(r"(계약서|contract|협약)", re.I), "문서"),
]
```

---

## 개선 우선순위

| 순위 | 항목 | 예상 효과 | 코드 변경 범위 |
|:---:|---|---|---|
| 1 | 카테고리 체계 통일 + Tier 2 키워드 확장 | 높음 | `tier2_embedding.py` |
| 2 | Tier 1 임계값 조정 또는 텍스트 불가 파일 조기 종료 | 중간 | `pipeline.py` |
| 3 | Tier 2 텍스트 입력 길이 확장 (1000 → 2000) | 낮음 | `tier2_embedding.py` |
| 4 | 파일명 패턴 매칭 강화 | 중간 | `tier1_rule.py` |
| 5 | PDF 소페이지 문서 추출 전략 개선 | 낮음 | `text_extractor.py` |

---

## 장기 개선 방향

- **피드백 루프 활용:** `is_manual=True`로 수동 수정된 결과를 Tier 2 카테고리 키워드 학습에 반영하는 구조를 추가하면, 사용할수록 정확도가 향상되는 시스템이 된다.
- **카테고리 계층화:** 현재 단일 카테고리 구조를 대분류/소분류로 나누면 더 세밀한 분류가 가능하다. (예: `문서 > 학술`, `문서 > 업무`)
- **사용자별 카테고리 학습:** 같은 사용자의 수동 분류 패턴을 누적해 개인화된 분류 기준을 만든다.
